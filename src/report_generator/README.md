# Report Generator

The report generation process runs in **four main phases**:

### 1. Prepare Phase – Aggregate Data via SQL

- This phase updates the existing summary row in the database for the completed scan.
    
- The summary row is initially inserted during the scan.
    
- This step populates additional statistical fields by aggregating data from `hosts` and `ports` tables using SQL.
    
- All queries are **filtered by country and scan timestamp**, ensuring only relevant data is included.
    

### 2. Create Report Phase – Generate LaTeX Reports

- Reports are generated for each scanned CIDR block using LaTeX.
    
- These are meant for **network administrators**, offering per-IP and per-port details.
    
- A **nation-level summary report** is also created for the **project supervisor**, summarizing key statistics across all scanned networks.
    

### 3. Email Report – Send to Supervisor

- The `email_handler.py` script picks the **latest PDF supervisor report** for the configured `NATION` and sends it via SMTP.
    
- Credentials and configuration are read from environment variables.
    
- This allows for seamless delivery of reports to stakeholders.
    

### 4. Backup to MinIO – Secure Archival

- A separate script (not shown here) uses **Duplicity + GPG** to:
    
    - Encrypt the reports
        
    - Upload them to a **MinIO backup bucket**
        

---

## Report Types

- **Supervisor Summaries**: One per country (top open ports, services, operating systems).
    
- **Detailed Reports**: One per CIDR block (lists IPs, open ports, services).
    

---

## Prerequisites

- **Python 3.8+**
    

Install dependencies:

```bash
pip install -r requirements.txt
sudo apt install texlive-full
```

Main dependencies:

- `psycopg2` – PostgreSQL client
    
- `pyffx` – Format-preserving encryption
    
- `texlive-full` – Required for LaTeX report generation
    

---

## Environment Variables

Create a `.env` file in the project root with the following:

```bash
# PostgreSQL
DB_HOST=...
DB_PORT=...
DB_USER=...
DB_PASS=...
DB_NAME=...

# IP Encryption (must match scanning side)
FPE_KEY=...
FPE_ALPHABET=...
FPE_LENGTH=...

# Email configuration
SMTP_SERVER=...
SMTP_PORT=587
SMTP_USER=...
SMTP_PASS=...
EMAIL_FROM=reports@volva.org
EMAIL_TO=recipient@example.com
NATION=IS
```

Then load them:

```bash
source .env
```

## Run the Report Generator

In the root folder scanner/
```bash
python -m src.report_generator.main
```

---

## Customization

- Modify `/src/report_generator/templates/` to adjust branding, format, or contents of the LaTeX reports.
    
- You may also tweak `email_handler.py` if more advanced email logic is needed (e.g., multi-attachment support, HTML formatting).
    

---

> _Generated by Völva_

---
